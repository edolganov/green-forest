<!DOCTYPE html>

<html>
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
	<title>Green-forest Framework Reference Guide</title>
	
	<link rel="stylesheet" type="text/css" href="css/reset.css"/>
	<link type="text/css" rel="stylesheet" href="css/shCoreDefault.css"/>
	<link rel="stylesheet" type="text/css" href="css/main.css"/>
	
	<script type="text/javascript" src="js/jquery-1.6.1-min.js" ></script>
	<script type="text/javascript" src="js/jquery-ui-1.8.24.custom.min.js" ></script>
	<script type="text/javascript" src="js/lang.js" ></script>
	<script type="text/javascript" src="js/guide.js" ></script>
	<script type="text/javascript" src="js/shCore.js"></script>
	<script type="text/javascript" src="js/shBrushJava.js"></script>
	<script type="text/javascript" src="js/effects.js"></script>
</head>
<body>

<div id="wrap">
	
	<div class="section">
		<img id="logo" src="i/gf-logo.png" alt="logo"/>
		<h1>Green-forest Framework Reference Guide</h1>
	</div>
	
	<div class="section toc"></div>
	
	<div class="importBlock" p-url="./chapters/01_overview.html"></div>
	<div class="importBlock" p-url="./chapters/02_features.html"></div>
	

	
		
		
	
 	<h2>Getting Started</h2>
 	
	<p>
	<span class="title">Add library to project</span>
 	<br>Get the latest version of <gff> from <a target="_blank" href="https://code.google.com/p/green-forest/downloads/list">download page</a>.
 	The zip archive with name like <tt>"green-forest-X.X-pack"</tt> contains binaries, javadocs and sources. 
 	<gf> has no dependencies for itself. Add the library to your Project.
 	
 	
	<p class="more-top">
	<span class="title">I. Create Actions</span>
	<div class="def">
		<p><b><a id="action">Action</a></b> presents some atomic logic operation (like function in interface) 
		and contains input and output data. 
	</div>
	<p>For example we have <tt>Doc</tt> class for presents some document object. 
	So in our app we can create actions like 
	<tt>CreateDoc</tt>, 
	<tt>RenameDoc</tt>, 
	<tt>DeleteDoc</tt> for working with documents. 
	And <tt>CreateDoc</tt> for example has input <tt>String</tt> (name of the doc) and output <tt>Doc</tt> (created object):

	<pre class="brush: java;">
		import com.gf.Action;
	
		public class CreateDoc extends Action&lt;String, Doc&gt;{
		
			public CreateDoc(String name) {
				super(name);
			}
			
		}</pre>


	<p class="more-top">
	<span class="title">II. Create Handlers</span>
	<div class="def">
		<p><b><a id="handler">Handler</a></b> implements logic of the action (like interface function's implementation). 
		It uses Action object for taking input data and setting output data.
	</div>
	<p>Note: Handler must contains <tt>@Mapping</tt> annotation.
	<p>Let's implement <tt>CreateDoc</tt> logic:
	<pre class="brush: java;">
	import com.gf.Handler;
	import com.gf.annotation.Mapping;
	
	import foo.Storage;
	
	@Mapping(CreateDoc.class)
	public class CreateDocHandler extends Handler&lt;CreateDoc&gt;{
	
		@Inject
		Storage storage;
		
		public void invoke(CreateDoc action) throws Exception {
		
			String name = action.getInput();
			Doc created = storage.createNewDoc(name);
			
			action.setOutput(created);
		}
	}</pre>
	
 	
	<p class="more-top">
	<span class="title">III. Connect actions with handlers by Engine</span>
	<div class="def">
		<p><b>Engine</b> is the central class of <gff>. 
		Use it for create object with Action-Handler API.
	</div>
	<pre class="brush: java;">
	import com.gf.core.Engine;
	
	Engine engine = new Engine();
	engine.addToContext(storage);
	engine.putHandler(CreateDocHandler.class);
	
	Doc result = engine.invoke(new CreateDoc("some name"));</pre>
	
	<p class="more-top">
	<span class="title">IV. Use class scanner</span>
	<br>If you have a set of handlers, interceptors and filters you can add all of them by package scanning:
	<pre class="brush: java;">
	import com.gf.core.Engine;
	
	Engine engine = new Engine();
	
	//put all valid handlers, interceptors and filters
	engine.scanAndPut("foo.bar");
	
	Doc result = engine.invoke(new CreateDoc("some name"));</pre>
	
	
	<p class="more-top">
	<span class="title">V. Create understandable interface</span>
	<br>Use understandable name of your API not just the universal <tt>Engine</tt>.
	For this reason you can extend <tt>ActionService</tt> interface: 
	<pre class="brush: java;">
	import com.gf.service.ActionService;

	public interface DocService extends ActionService { }
	
	
	//example of service using
	DocService service = getService();
	Doc result = service.invoke(new CreateDoc("some name"));</pre>
	
	<p>And create implementation with <tt>Engine</tt> inside:
	<pre class="brush: java;">
	import com.gf.core.Engine;
	import foo.Storage;
	
	public class DocServiceImpl implements DocService {

		private Engine engine;
	
		public DocServiceImpl() {
		
			Storage storage = new Storage();
			
			engine = new Engine();
			engine.addToContext(storage);
			engine.putHandler(CreateDocHandler.class);
		}
		
		
		public &lt;I, O&gt; O invoke(Action&lt;I, O&gt; action) {
			return engine.invoke(action);
		}
		
		public &lt;I, O&gt; O invokeUnwrap(Action&lt;I, O&gt; action) throws Exception {
			return engine.invokeUnwrap(action);
		}
	
	}</pre>
	
	
	<p class="more-top">
	<span class="title"><a id="aspects">VI. Add aspects things</a></span>
	<br>In next step you can use <tt>Filters</tt> and <tt>Interveptors</tt> for aspects (like validation or security).
	<p>Example of security filter:
	<pre class="brush: java;">
	import com.gf.Filter;
	
	public class SecurityFilter extends Filter {
		
		@Override
		public void invoke(Action&lt;?, ?&gt; action, FilterChain chain) 
				throws Exception {
			
			boolean isPermitted = checkUserPermissions();
			
			if( ! isPermitted) throw new SecutiryException();
			else chain.doNext();
			
		}
	
	}</pre>
	
	<p>And example of validation interceptor:
	<pre class="brush: java;">
	import com.gf.Interceptor;
	import com.gf.annotation.Mapping;

	@Mapping(CreateDoc.class)
	public class CheckNameInterceptor extends Interceptor&lt;CreateDoc&gt;{
	
		@Override
		public void invoke(CreateDoc action, InterceptorChain chain)
				throws Exception {
			
			String name = action.input();
			if(name == null 
					|| name.length() == 0)
				throw new InvalidNameException();
			
			chain.doNext();
			
		}
	
	}</pre>
	
	
	<h2>JEE Integration</h2>
	
	
	<h2>Spring Integration</h2>
	
	
	<h2>MyBatis Integration</h2>
	
	
	<h2>JDBC and Transactions</h2>
	
	
	<h2>Logging</h2>
	
	
	<h2>Complex Examples</h2>

 	
 	<h2>Known Issues</h2>
 	 	<!--  
 	<div class="warning">
 		<div class="title">Special for Jboss AS</div>
 		<p>If you want use class scanner in <span class="name">JBoss AS</span> you need this additional libraries:
 		<ul>
 			<li><a href='http://code.google.com/p/reflections/'>Reflections</a></li>
 			<li><a href='http://code.google.com/p/guava-libraries/'>The Guava project</a></li>
 			<li><a href='http://www.csg.ci.i.u-tokyo.ac.jp/~chiba/javassist/'>Javassist</a></li>
 		</ul>
 	</div>
 	-->
	

 	<h2>Best Practices</h2>
 	
 	<p>
	<span class="title">Use Action for additional logic</span>
	<br><tt>Action</tt> can be not only the data container: you can use it for validation and standardization's things.
	<br>Example of additional action's logic:
	<pre class="brush: java;">
	//1. create common interface for validation
	public interface HasDocNames {
	
		List&lt;String&gt; getNames();
	
	}
	
	//2. add interface to acitons:
	public class CreateDocs extends Action&lt;List&lt;String&gt;, List&lt;Doc&gt;&gt; 
		implements HasDocNames {
	
		public CreateDocs(List&lt;String&gt; names) {
			super(names);
		}
		
		//additional logic
		public List&lt;String&gt; getNames() {
			return input;
		}
	
	}
	
	public class RenameDoc extends Action&lt;Doc, Void&gt; 
		implements HasDocNames {
		
		public RenameDoc(int id, String newName){
			this(new Doc(id, newName));
		}
	
		//additional logic
		public List&lt;String&gt; getNames() {
			if(input != null){
				return Util.list(input.name);
			}
			return null;
		}
	
	}
	
	//3. use additional logic in validation
	@Mapping(HasDocNames.class)
	public class CheckDocNameInterceptor extends Interceptor&lt;Action&lt;?,?&gt;&gt;{
	
		@Override
		public void invoke(Action&lt;?, ?&gt; action, InterceptorChain chain) 
			throws Exception {
			
			HasDocNames hasDocNames = ((HasDocNames)action);
			List&lt;String&gt; names = hasDocNames.getNames();
			
			boolean isValid = validateNames(names);
			
			if( ! isValid) throw new InvalidNameException();
			
			chain.doNext();
			
		}
	
	}
	</pre>
 	
 	

 	<h2>License</h2>
 	

</div>

</body>
</html>