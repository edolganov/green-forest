<!DOCTYPE html>

<html>
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
	<title>Green-forest Framework Reference Guide</title>
	
	<link rel="stylesheet" type="text/css" href="css/reset.css"/>
	<link type="text/css" rel="stylesheet" href="css/shCoreDefault.css"/>
	<link rel="stylesheet" type="text/css" href="css/main.css"/>
	
	<script type="text/javascript" src="js/jquery-1.6.1-min.js" ></script>
	<script type="text/javascript" src="js/jquery-ui-1.8.24.custom.min.js" ></script>
	<script type="text/javascript" src="js/lang.js" ></script>
	<script type="text/javascript" src="js/guide.js" ></script>
	<script type="text/javascript" src="js/shCore.js"></script>
	<script type="text/javascript" src="js/shBrushJava.js"></script>
	<script type="text/javascript">SyntaxHighlighter.all();</script>
	<script type="text/javascript" src="js/effects.js"></script>
</head>
<body>

<div id="wrap">
	
	<div class="section">
		<img id="logo" src="i/gf-logo.png" alt="logo"/>
		<h1>Green-forest Framework Reference Guide</h1>
	</div>
	
	<div class="section toc"></div>
	
	<h2>Overview</h2>
	<p>
	<gff> is the simple <a href='#ioc-container'>IoC Container</a> with <a href="#action-handler">Action-Handler architecture</a>. 
	It's not a competitor for <sf> or <jee> but it's a powerful addition for this frameworks. 
	You can use <gf> for a single class implementation and for a complex business logic.
	
	
	
	<h2>Features</h2>
	<p>
	<span class="title"><a id="ioc-container">IoC Container</a></span>
	<br>With <gf> you can separate your application's logic into simple atomic classes. 
	The framework organizes communications between this classes.
	Also you can add an external object into invocation context and use it by dependency injection.
	
	<p class="more-top">
	<span class="title"><a id="action-handler">Action-Handler architecture</a></span>
	<br>API of <gf> has only one method: <tt>invoke</tt>. 
	This method takes <a href="#action">Action</a> object with input data, finds targeted <a href="#handler">Handler</a> and return handler's output. 
	<br>Take a look for the illustrating picture:
	<div class="image-wrap">
		<img class="pic2" src="i/action-handler-pattern.png" width="90%">
		<div>Action-Handler architecture</div>
	</div>
	<p>Code example:
	<pre class="brush: java;">
		//create Green-forest Engine
		Engine engine = new Engine();
		
		//register some handler
		engine.putHandler(SomeActonHandler.class);
		
		//invoke some action and get result
		String result = engine.invoke(new SomeAction("some data"));</pre>
		

	<p class="more-top">
	<span class="title">Aspects implementation</span>
	<br><gf> contains <a href="#filter">Filters</a> and <a href="#interceptor">Interceptors</a>. 
	With these instruments you can implement a lot of aspects things (like <tt>validation</tt>, <tt>wrapping</tt>, <tt>logging</tt> etc)
	without using special aspect libraries (like <span class='name'>AspectJ</span>).
	<p>Code example:
	<pre class="brush: java;">
		public class WorktimeFilter extends Filter {
		
			@Override
			public void invoke(Action&lt;?, ?&gt; action, FilterChain chain) 
				throws Exception {
				
				Date begin = new Date();
				try {
					//next handler
					chain.doNext();
				}finally {
					long worktime = System.currentTimeMillis() - begin.getTime();
					log.info("worktime: "+worktime+"ms");
				}
			}
		
		}</pre>
	

	<p class="more-top">
	<span class="title">Isolated contexts</span>
	<br>You can use one <gf> inside another like external object.
	In this way you can separate a big application context to few small isolated contexts that use each other.
	<br>Take a look for the illustrating picture:
	<div class="image-wrap">
		<img class="pic" src="i/isolated-context.png" width="90%">
		<div>Difference between single and isolated contexts</div>
	</div>
	<p>Code example:
	<pre class="brush: java;">
		//Handler
		@Mapping(SomeAction.class)
		public class SomeHandler extends Handler&lt;SomeAction&gt;{
		
			@Inject
			SomeService service;
			
			@Inject
			OtherService otherService;
			
			@Override
			public void invoke(SomeAction action) throws Exception {
					
				//external object with action-handler API
				service.invoke(new OtherAction());
				
				//other external object
				otherService.someMethod();
				
			}
		}</pre>
		
		
	
 	<h2>Getting Started</h2>
 	
	<p>
	<span class="title">0. Add library to project</span>
 	<br>Get the latest version of <gff> from <a target="_blank" href="https://code.google.com/p/green-forest/downloads/list">download page</a>.
 	The zip archive with name like <tt>"green-forest-X.X-pack"</tt> contains binaries, javadocs and sources. 
 	<gf> has no dependencies for itself. Add the library to your Project.
 	
 	
	<p class="more-top">
	<span class="title">I. Create Actions</span>
	<div class="def">
		<p><b><a id="action">Action</a></b> presents some atomic logic operation (like function in interface) 
		and contains input and output data. 
	</div>
	<p>For example we have <tt>Doc</tt> class for presents some document object. 
	So in our app we can create actions like 
	<tt>CreateDoc</tt>, 
	<tt>RenameDoc</tt>, 
	<tt>DeleteDoc</tt> for working with documents. 
	And <tt>CreateDoc</tt> for example has input <tt>String</tt> (name of the doc) and output <tt>Doc</tt> (created object):

	<pre class="brush: java;">
		import com.gf.Action;
	
		public class CreateDoc extends Action&lt;String, Doc&gt;{
		
			public CreateDoc(String name) {
				super(name);
			}
			
		}</pre>


	<p class="more-top">
	<span class="title">II. Create Handlers</span>
	<div class="def">
		<p><b><a id="handler">Handler</a></b> implements logic of the action (like interface function's implementation). 
		It uses Action object for taking input data and setting output data.
	</div>
	<p>Note: Handler must contains <tt>@Mapping</tt> annotation.
	<p>Let's implement <tt>CreateDoc</tt> logic:
	<pre class="brush: java;">
	import com.gf.Handler;
	import com.gf.annotation.Mapping;
	
	import foo.Storage;
	
	@Mapping(CreateDoc.class)
	public class CreateDocHandler extends Handler&lt;CreateDoc&gt;{
	
		@Inject
		Storage storage;
		
		public void invoke(CreateDoc action) throws Exception {
		
			String name = action.getInput();
			Doc created = storage.createNewDoc(name);
			
			action.setOutput(created);
		}
	}</pre>
	
 	
	<p class="more-top">
	<span class="title">III. Connect actions with handlers by Engine</span>
	<div class="def">
		<p><b>Engine</b> is the central class of <gff>. 
		Use it for create object with Action-Handler API.
	</div>
	<pre class="brush: java;">
	import com.gf.core.Engine;
	
	Engine engine = new Engine();
	engine.addToContext(storage);
	engine.putHandler(CreateDocHandler.class);
	
	Doc result = engine.invoke(new CreateDoc("some name"));</pre>
	
	
	<p class="more-top">
	<span class="title">IV. Create understandable interface</span>
	<br>Use understandable name of your API not just the universal <tt>Engine</tt>.
	For this reason you can extend <tt>ActionService</tt> interface: 
	<pre class="brush: java;">
	import com.gf.service.ActionService;

	public interface DocService extends ActionService { }
	
	
	//example of service using
	DocService service = getService();
	Doc result = service.invoke(new CreateDoc("some name"));</pre>
	
	<p>And create implementation with <tt>Engine</tt> inside:
	<pre class="brush: java;">
	import com.gf.core.Engine;
	import foo.Storage;
	
	public class DocServiceImpl implements DocService {

		private Engine engine;
	
		public DocServiceImpl() {
		
			Storage storage = new Storage();
			
			engine = new Engine();
			engine.addToContext(storage);
			engine.putHandler(CreateDocHandler.class);
		}
		
		
		public &lt;I, O&gt; O invoke(Action&lt;I, O&gt; action) {
			return actionService.invoke(action);
		}
		
		public &lt;I, O&gt; O invokeUnwrap(Action&lt;I, O&gt; action) 
			throws Exception {
			return actionService.invokeUnwrap(action);
		}
	
	}</pre>
	
	
	<p class="more-top">
	<span class="title">V. Add aspects things</span>
	<br>In next step you can use <tt>Filters</tt> and <tt>Interveptors</tt> for aspects (like validation or security).
	<p>Example of security filter:
	<pre class="brush: java;">
	import com.gf.Filter;
	
	public class SecurityFilter extends Filter {
		
		@Override
		public void invoke(Action&lt;?, ?&gt; action, FilterChain chain) 
				throws Exception {
			
			boolean isPermitted = checkUserPermissions();
			
			if( ! isPermitted) throw new SecutiryException();
			else chain.doNext();
			
		}
	
	}</pre>
	
	<p>And example of validation interceptor:
	<pre class="brush: java;">
	import com.gf.Interceptor;
	import com.gf.annotation.Mapping;

	@Mapping(CreateDoc.class)
	public class CheckNameInterceptor extends Interceptor&lt;CreateDoc&gt;{
	
		@Override
		public void invoke(CreateDoc action, InterceptorChain chain)
				throws Exception {
			
			String name = action.input();
			if(name == null 
					|| name.length() == 0)
				throw new InvalidNameException();
			
			chain.doNext();
			
		}
	
	}</pre>
	
	
	<p class="more-top">
	<span class="title">VI. Use class scanner</span>
	<br>If you have a set of handlers, interceptors and filters you can add all of them by package scanning:
	<pre class="brush: java;">
	import com.gf.core.Engine;
	
	Engine engine = new Engine();
	
	//put all valid handlers, interceptors and filters
	engine.scanAndPut("foo.bar");
	
	Doc result = engine.invoke(new CreateDoc("some name"));</pre>
	

 	<h2>Best practices</h2>
 	
 	
 	
 	<h2>Complex examples</h2>
 	
 	
 	<h2>Issues</h2>
 	
 	

 	
 	<!--  
 	<div class="warning">
 		<div class="title">Special for Jboss AS</div>
 		<p>If you want use class scanner in <span class="name">JBoss AS</span> you need this additional libraries:
 		<ul>
 			<li><a href='http://code.google.com/p/reflections/'>Reflections</a></li>
 			<li><a href='http://code.google.com/p/guava-libraries/'>The Guava project</a></li>
 			<li><a href='http://www.csg.ci.i.u-tokyo.ac.jp/~chiba/javassist/'>Javassist</a></li>
 		</ul>
 	</div>
 	-->
 	

</div>

</body>
</html>